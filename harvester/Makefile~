# Makefile for etdportal project
# hussein suleman
# 20 august 2010

# variables

JFLAGS = -classpath WEB-INF/lib/mysql-connector-java.jar:WEB-INF/lib/servlet-api.jar:. \
         -d WEB-INF/classes \
         -sourcepath WEB-INF/classes

JAVAC = javac

TOMCAT = tomcat6
WEBAPPS = /usr/share/$(TOMCAT)/webapps

# rules

%.class: %.java
	$(JAVAC) $(JFLAGS) $<

# targets

TARGETS = WEB-INF/classes/OAIHarvest.class \
          WEB-INF/classes/HarvesterServlet.class \
          WEB-INF/classes/ConfigWriter.class \
          WEB-INF/classes/DatabaseConnection.class \
          WEB-INF/classes/HarvestConfiguration.class \
          WEB-INF/classes/HarvesterThread.class \
          WEB-INF/classes/HtmlPane.class \
          WEB-INF/classes/HTMLWriter.class \
          WEB-INF/classes/NavBar.class \
          WEB-INF/classes/OAIConfigEditor.class \
          WEB-INF/classes/OAIRecord.class \
          WEB-INF/classes/OAIRequest.class \
          WEB-INF/classes/OAIResponseHandler.class \
          WEB-INF/classes/OAIScheduledHarvest.class \
          WEB-INF/classes/RepoList.class \
          WEB-INF/classes/RepositoryEditor.class \
          WEB-INF/classes/Settings.class \
          WEB-INF/classes/StatusPane.class
          
all: $(TARGETS)

clean:
	for comp in $(TARGETS); do \
	   rm $$comp; \
	done
	@echo Finis.
	
install:
	install -o $(TOMCAT) -v -d $(WEBAPPS)/harvester/style
	install -o $(TOMCAT) -v -d $(WEBAPPS)/harvester/WEB-INF/classes
	install -o $(TOMCAT) -v -d $(WEBAPPS)/harvester/WEB-INF/config/sources
	install -o $(TOMCAT) -v -d $(WEBAPPS)/harvester/WEB-INF/lib
	install -o $(TOMCAT) -v -m 644 style/style.css $(WEBAPPS)/harvester/style/
	install -o $(TOMCAT) -v -m 644 WEB-INF/config/config.xml $(WEBAPPS)/harvester/WEB-INF/config/
	install -o $(TOMCAT) -v -m 644 WEB-INF/config/install_db.sql $(WEBAPPS)/harvester/WEB-INF/config/
	install -o $(TOMCAT) -v -m 644 WEB-INF/lib/mysql-connector-java.jar $(WEBAPPS)/harvester/WEB-INF/lib/
	install -o $(TOMCAT) -v -m 644 WEB-INF/lib/servlet-api.jar $(WEBAPPS)/harvester/WEB-INF/lib/
	for comp in $(TARGETS); do \
	   install -o $(TOMCAT) -v -m 644 $$comp $(WEBAPPS)/harvester/classes/; \
	done
	@echo Finis.

